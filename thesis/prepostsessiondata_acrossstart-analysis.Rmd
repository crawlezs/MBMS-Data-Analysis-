---
title: "prepostsessiondata_acrossstart-analysis"
output: html_document
---

Load necessary packages
```{r}
library(tidyr)
library(tidyREDCap)
library(tibble)
library(dplyr)
library(data.table)
library(lme4)
library(nlme)
library(qwraps2)
library(rstatix)
library(ggpubr)
```

Load data
```{r}
print(PrePostData)

#where session = number of the session
#where time(0)= start and time(1)= end
```
The first analysis will be a linear mixed model of PANAS and IOS scores across the 7 sessions, using only start scores. 

**Steps of analysis:**
1. Create a data frame of Start data
2. Run descriptive statistics of panas_pos, panas_neg, and ios
    a. Score means by Session
    b. Score means by ID
    c. Boxplot of Scores over Session, by ID
    d. QQ plot of Scores over Session, by ID
    e. Check for outliers 
    f. Check for normality 
3. Run repeated measures ANOVA to establish significant difference between scores across time
    a. gather data frame by time
    b. run anova with unchanged df
    c. run anova with outliers removed
4.


1. Create new data frame, start only 
```{r}
StartOnly <- filter(PrePostData, time==0)
StartOnly <- select(StartOnly, -time)
print(StartOnly)
```
2. Run Descriptive Statistics
```{r}
###Session Means##
Session_Means <- as_tibble(
  StartOnly %>%
  group_by(session)%>%
  get_summary_stats(type="mean_sd"))

print(Session_Means)

##Individual Means##
ID_Means <- as_tibble(
  StartOnly %>%
  group_by(id)%>%
  get_summary_stats(type="mean_sd"))

print(ID_Means)

#Save descriptive tables
write.csv(Session_Means,"C:\\Users\\19149\\Documents\\R\\win-library\\4.1\\MBMS-Data-Analysis-\\MBMS-Data-Analysis-\\thesis\\data\\StartOnly_SessionMeans.csv", row.names = FALSE)

write.csv(ID_Means,"C:\\Users\\19149\\Documents\\R\\win-library\\4.1\\MBMS-Data-Analysis-\\MBMS-Data-Analysis-\\thesis\\data\\StartOnly_IDMeans.csv", row.names = FALSE)
```

```{r}
#Create a box plot: PANAS POS
bxp_pos <- ggboxplot(StartOnly, x= 'session', y= 'panas_pos', add="point", title= "PANAS Positive Scores") 
bxp_pos

#Save box plot: PANAS POS
ggsave("C:\\Users\\19149\\Documents\\R\\win-library\\4.1\\MBMS-Data-Analysis-\\MBMS-Data-Analysis-\\thesis\\panas_pos_bxplot.png", plot = last_plot(), scale = 1)

#Create a box plot: PANAS NEG
bxp_neg <- ggboxplot(StartOnly, x= 'session', y= 'panas_neg', add="point", title= "PANAS Negative Scores") 
bxp_neg

#Save box plot: PANAS NEG
ggsave(filename = "C:\\Users\\19149\\Documents\\R\\win-library\\4.1\\MBMS-Data-Analysis-\\MBMS-Data-Analysis-\\thesis\\panas_nrg_bxplot.png", plot = last_plot(),scale = 1)

#Create a box plot: IOS
bxp_ios <- ggboxplot(StartOnly, x= 'session', y= 'ios', add="point", title = "IOS Scores") 
bxp_ios

#Save box plot: IOS
ggsave(filename = "C:\\Users\\19149\\Documents\\R\\win-library\\4.1\\MBMS-Data-Analysis-\\MBMS-Data-Analysis-\\thesis\\ios_bxplot.png", plot = last_plot(),scale = 1)
```


```{r}
#Check for Outliers
outliers_panaspos <- as_tibble(
  StartOnly%>%
  group_by(session) %>%
  identify_outliers(panas_pos))

outliers_panasneg <- as_tibble(
StartOnly%>%
  group_by(session) %>%
  identify_outliers(panas_neg))

outliers_ios <- as_tibble(
StartOnly%>%
  group_by(session) %>%
  identify_outliers(ios))

outliers <- full_join(outliers_panaspos, outliers_panasneg)
outliers <- full_join(outliers, outliers_ios)
print(outliers)

write.csv(outliers,"C:\\Users\\19149\\Documents\\R\\win-library\\4.1\\MBMS-Data-Analysis-\\MBMS-Data-Analysis-\\thesis\\data\\StartOnly_Outliers.csv", row.names = FALSE)

```
```{r}
#check for Normality
StartOnly%>%
  ggqqplot("panas_pos", facet.by = "session", title = "PANAS Positive Scores")

StartOnly%>%
  ggqqplot("panas_neg", facet.by = "session", title = "PANAS Negative Scores")

StartOnly%>%
  ggqqplot("ios", facet.by = "session", title = "IOS Scores")
```


